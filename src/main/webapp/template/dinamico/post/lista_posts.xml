<engine>
	<template selector="#content_left">
		<div id="content_left_stretch">
			<ul class="list_stories" id="relacao_dos_posts">
				{for post in posts}
				<li class="clearfix" id="${post.id}">
					<div class="avatar-frame avatar-frame-small" title="Por ${post.usuario}">
						<img src="${gravatar}${post.usuarioMD5}" alt="Avatar" />
					</div>
					<div class="speech-shape"></div>
					<a class="list_stories_headline clearfix" href="#">
						<h2 class="titulo ${post.id} wordwrap" >${post.titulo}</h2>
					</a>

					<!-- Lead -->
					<div class="conteudo_inicial list_stories_lead hyphenize wordwrap">${dextranet.post.conteudoParaExibicao(post.conteudo)}</div>

					<!-- Conteudo completo do post -->
					<div id="${post.id}_post" class="list_stories_contents hidden">
						<div class="idClassPost wordwrap" id="${post.id}">
							${post.conteudo}
						</div>
					</div>

					<!-- Curtidas, quantidade de comentarios, data, excluir -->
					<div class="list_stories_data clearfix">
						<div class="list_stories_dx clearfix">
							<a id="like_${post.id}" class="linkCurtir post">
								<span class="icon_dx" onclick="dextranet.post.curtir('${post.id}');"></span>
							</a>
							<a id="showLikes_${post.id}" class="showLikes"
								onclick="dextranet.post.listarCurtidas('${post.id}');">
								<span class="numero_curtida">${post.quantidadeDeCurtidas}</span>
								<span>${messages.post_curtidas}</span>
							</a>
						</div>
						<div class="list_stories_numbercomments">
							<a id="${post.id}">
								<span class="icon_comments"></span>
								<span class="numero_comentario">${post.quantidadeDeComentarios}</span>
								${messages.post_comentario}
							</a>
						</div>
						<span class="list_stories_date time_ago">${post.dataDeAtualizacao}</span>
						{if post.usuario == dextranet.usuario.logado.username}
							<button class="btn btn-small btn-light btn-excluirpost" title="Excluir este post" onclick="dextranet.post.remover('${post.id}')"><strong>x </strong> ${messages.post_excluir}</button><!-- @toDo tooltip -->
						{/if}
					</div>

					<!-- Novo comentario -->
					<div class="list_stories_newcomment hidden">
						<form id="form_comment" class="clearfix form-dark form-fields-block">
							<div class="new-comment clear">
								<div class="avatar-frame" title="Por ${post.usuario}">
									<img src="${gravatar}${post.usuarioMD5}" alt="Avatar" />
								</div>
								<textarea cols="50" id="idConteudoComentario" class="idConteudoComentario not-empty"
									style="resize:none;" name="conteudoComentario" tabindex="10"
									placeholder="Deixe seu comentario... "></textarea>
								<div class="speech-shape-small"></div>
							</div>
							<button class="btn btn-blue float_right" id="form_comentar_submit"
								type="button" tabindex="11" onclick="dextranet.post.comentar('${post.id}')">Comentar</button>
						</form>
						<!-- Comentarios -->
						<ul class="list_stories_comments" id="relacao_dos_comentarios">
							{for comentario in post.comentarios}
							<li class="clearfix">
								<div class="avatar-frame" title="Por ${comentario.usuario}">
									<img src="${gravatar}${comentario.usuarioMD5}" alt="Avatar" />
								</div>
								<div class="speech-shape-small"></div>
								<div class="content">
									<p class="wordwrap">${comentario.conteudo}</p>
									<div class="comment-data">
										<span class="list_stories_date time_ago">${comentario.dataDeCriacao}
										</span>
										<button class="btn btn-small btn-light btn-excluirpost"
											title="Excluir este post">
											<strong>x </strong>
											Excluir
										</button><!-- @toDo tooltip -->
										<div class="list_stories_dx">
											<a id="${comentario.id}" class="clearfix linkCurtir post">
												<span class="icon_dx"></span>
												<span class="numero_curtida">${comentario.quantidadeDeCurtidas}</span>
											</a>
										</div>
									</div>
								</div>
							</li>
							{/for}
						</ul>
					</div>
				</li>
				{/for}
			</ul>
		</div>
		<div id="div_curtidas_dialog"></div>

		<script type="text/javascript">
			<![CDATA[
			$('.new-comment textarea').autoresize();


			$.each($('.time_ago'), function(){
				data_completa = $(this).html();
				tempo_atras = timeAgo.calcular(data_completa);
				$(this).html(tempo_atras);
				$(this).attr('title', data_completa);
			});

			$('.list_stories_headline').click(function(e)
			{
				e.preventDefault();
				var item = $(this).parent('li');
				if ( item.hasClass('expanded') === true )
				{
					item.removeClass('expanded');
					item.find('.list_stories_lead').show();
					item.find('.list_stories_contents,.list_stories_comments,.list_stories_newcomment').hide();
				}
				else
				{
					item.addClass('expanded');
					item.find('.list_stories_lead').hide();
					item.find('.list_stories_contents,.list_stories_comments,.list_stories_newcomment').show();
				}
			});

			$('.list_stories_numbercomments').click(function() {
				$(this).parents('li').find('.list_stories_headline').click();
			});

			
			{if idPost && typeof idPost != "object"}
				itemComentario = $('#${idPost}');
				var item = itemComentario.find('.list_stories_headline');
				item.click();
			{/if}
			]]>
		</script>
	</template>
</engine>
